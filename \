---

- name: Install Forever
  npm:
    name: forever
    global: yes
    state: present

- name: Remove frontend node_modules
  file: path="{{ node_apps_location }}/frontend/node_modules"  state=absent

- name: Remove backend node_modules
  file: path="{{ node_apps_location }}/backend/node_modules"  state=absent

- name: Check list of running Node.js apps.
  command: forever list
  register: forever_list
  changed_when: false

- name: Stop all forever instances
  command: forever stopall

- name: Start example Node.js app.
  command: "make run -C {{ node_apps_location }}"
  when: "forever_list.stdout.find(node_apps_location + '/src/app.js') == -1"
